name: Docker Image CI (Workflow)
on: [push, pull_request]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Build the Docker image
      run: |
        cd tutorials/workflow
        docker build --tag ploomber-workflow .
    - name: Start a Docker container
      run: |
        export SHARED_DIR=$HOME/ploomber-workflow
        rm -rf $SHARED_DIR
        mkdir -p $SHARED_DIR
        docker run \
            --privileged=true -v /var/run/docker.sock:/var/run/docker.sock \
            --volume $SHARED_DIR:/mnt/shared-folder \
            --env SHARED_DIR \
            --env PLOOMBER_STATS_ENABLED=false \
            --network host \
            ploomber-workflow